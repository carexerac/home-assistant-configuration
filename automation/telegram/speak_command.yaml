id: telegram_speak
alias: 'Telegram bot that speak through Google Home'
hide_entity: true
trigger:
  platform: event
  event_type: telegram_command
  event_data:
    command: '/speak'
action:
  - service: telegram_bot.send_message
    data_template:
      target: '{{ trigger.event.data.chat_id }}'
      message: >
        {% if trigger.event.data.args[0] is undefined %}
        No message was specified (use '/speak {message}')
        {% else %}
        {{ [
          'Your slave will speak in a moment...',
          'Yes master',
          'Of course',
          'Sure thing',
          'You know you can open your mouth right ?',
          'You owe me a flavor'
        ]|random }}
        {% endif %}
      disable_notification: true
  - condition: template
    value_template: "{{ trigger.event.data.args[0] is defined }}"
  - service: tts.google_say
    entity_id: media_player.living_room_home
    data_template:
      language: "fr"
      cache: false
      message: >
        {{ [
          trigger.event.data["from_first"] + ' dit : ',
          trigger.event.data["from_first"] + ' a dit : ',
          'La bouche de ' + trigger.event.data["from_first"] + ' est coincée donc je vais parler à sa place. ',
          trigger.event.data["from_first"] + ' a trop la flemme de parler mais voici sa pensée : ',
          trigger.event.data["from_first"] + ' pense que : '
        ]|random }}{% for state in trigger.event.data["args"] %} {{ state }} {% endfor %}